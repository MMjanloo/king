<?php 
if(!function_exists('king_get_fonts_array')){
	function king_get_fonts_array(){
		$kingFontArray = array();
		$kingFontArray[] = array(
				'font_family' => 'Abril Fatface',
				'font_styles' => 'regular',
				'font_types' => '400 regular:400:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Arimo',
				'font_styles' => 'regular,italic,700,700italic',
				'font_types' => '400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Arvo',
				'font_styles' => 'regular,italic,700,700italic',
				'font_types' => '400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Cinzel',
				'font_styles' => 'regular,700,900',
				'font_types' => '400 regular:400:normal,700 bold regular:700:normal,900 bold regular:900:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Coda',
				'font_styles' => 'regular,800',
				'font_types' => '400 regular:400:normal,800 bold regular:800:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Condiment',
				'font_styles' => 'regular',
				'font_types' => '400 regular:400:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Delius',
				'font_styles' => 'regular',
				'font_types' => '400 regular:400:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Dosis',
				'font_styles' => '200,300,regular,500,600,700,800',
				'font_types' => '200 light regular:200:normal,300 light regular:300:normal,400 regular:400:normal,500 bold regular:500:normal,600 bold regular:600:normal,700 bold regular:700:normal,800 bold regular:800:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Droid Sans',
				'font_styles' => 'regular,700',
				'font_types' => '400 regular:400:normal,700 bold regular:700:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Exo',
				'font_styles' => '100,100italic,200,200italic,300,300italic,regular,italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic',
				'font_types' => '100 light regular:100:normal,100 light italic:100:italic,200 light regular:200:normal,200 light italic:200:italic,300 light regular:300:normal,300 light italic:300:italic,400 regular:400:normal,400 italic:400:italic,500 bold regular:500:normal,500 bold italic:500:italic,600 bold regular:600:normal,600 bold italic:600:italic,700 bold regular:700:normal,700 bold italic:700:italic,800 bold regular:800:normal,800 bold italic:800:italic,900 bold regular:900:normal,900 bold italic:900:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Istok Web',
				'font_styles' => 'regular,italic,700,700italic',
				'font_types' => '400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Josefin Slab',
				'font_styles' => '100,100italic,300,300italic,regular,italic,600,600italic,700,700italic',
				'font_types' => '100 light regular:100:normal,100 light italic:100:italic,300 light regular:300:normal,300 light italic:300:italic,400 regular:400:normal,400 italic:400:italic,600 bold regular:600:normal,600 bold italic:600:italic,700 bold regular:700:normal,700 bold italic:700:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Lato',
				'font_styles' => '100,100italic,300,300italic,regular,italic,700,700italic,900,900italic',
				'font_types' => '100 light regular:100:normal,100 light italic:100:italic,300 light regular:300:normal,300 light italic:300:italic,400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic,900 bold regular:900:normal,900 bold italic:900:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Lobster',
				'font_styles' => 'regular',
				'font_types' => '400 regular:400:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Merienda',
				'font_styles' => 'regular,700',
				'font_types' => '400 regular:400:normal,700 bold regular:700:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Merriweather',
				'font_styles' => '300,300italic,regular,italic,700,700italic,900,900italic',
				'font_types' => '300 light regular:300:normal,300 light italic:300:italic,400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic,900 bold regular:900:normal,900 bold italic:900:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Merriweather Sans',
				'font_styles' => '300,300italic,regular,italic,700,700italic,800,800italic',
				'font_types' => '300 light regular:300:normal,300 light italic:300:italic,400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic,800 bold regular:800:normal,800 bold italic:800:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Montserrat',
				'font_styles' => 'regular,700',
				'font_types' => '400 regular:400:normal,700 bold regular:700:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Neuton',
				'font_styles' => '200,300,regular,italic,700,800',
				'font_types' => '200 light regular:200:normal,300 light regular:300:normal,400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,800 bold regular:800:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Nothing You Could Do',
				'font_styles' => 'regular',
				'font_types' => '400 regular:400:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Noto Serif',
				'font_styles' => 'regular,italic,700,700italic',
				'font_types' => '400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Old Standard TT',
				'font_styles' => 'regular,italic,700',
				'font_types' => '400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Oleo Script',
				'font_styles' => 'regular,700',
				'font_types' => '400 regular:400:normal,700 bold regular:700:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Open Sans',
				'font_styles' => '300,300italic,regular,italic,600,600italic,700,700italic,800,800italic',
				'font_types' => '300 light regular:300:normal,300 light italic:300:italic,400 regular:400:normal,400 italic:400:italic,600 bold regular:600:normal,600 bold italic:600:italic,700 bold regular:700:normal,700 bold italic:700:italic,800 bold regular:800:normal,800 bold italic:800:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Open Sans Condensed',
				'font_styles' => '300,300italic,700',
				'font_types' => '300 light regular:300:normal,300 light italic:300:italic,700 bold regular:700:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Orbitron',
				'font_styles' => 'regular,500,700,900',
				'font_types' => '400 regular:400:normal,500 bold regular:500:normal,700 bold regular:700:normal,900 bold regular:900:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Oswald',
				'font_styles' => '300,regular,700',
				'font_types' => '300 light regular:300:normal,400 regular:400:normal,700 bold regular:700:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'PT Sans',
				'font_styles' => 'regular,italic,700,700italic',
				'font_types' => '400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'PT Serif',
				'font_styles' => 'regular,italic,700,700italic',
				'font_types' => '400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Permanent Marker',
				'font_styles' => 'regular',
				'font_types' => '400 regular:400:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Philosopher',
				'font_styles' => 'regular,italic,700,700italic',
				'font_types' => '400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Playfair Display',
				'font_styles' => 'regular,italic,700,700italic,900,900italic',
				'font_types' => '400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic,900 bold regular:900:normal,900 bold italic:900:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Radley',
				'font_styles' => 'regular,italic',
				'font_types' => '400 regular:400:normal,400 italic:400:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Raleway',
				'font_styles' => '100,200,300,regular,500,600,700,800,900',
				'font_types' => '100 light regular:100:normal,200 light regular:200:normal,300 light regular:300:normal,400 regular:400:normal,500 bold regular:500:normal,600 bold regular:600:normal,700 bold regular:700:normal,800 bold regular:800:normal,900 bold regular:900:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Roboto',
				'font_styles' => '100,100italic,300,300italic,regular,italic,500,500italic,700,700italic,900,900italic',
				'font_types' => '100 light regular:100:normal,100 light italic:100:italic,300 light regular:300:normal,300 light italic:300:italic,400 regular:400:normal,400 italic:400:italic,500 bold regular:500:normal,500 bold italic:500:italic,700 bold regular:700:normal,700 bold italic:700:italic,900 bold regular:900:normal,900 bold italic:900:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Roboto Condensed',
				'font_styles' => '300,300italic,regular,italic,700,700italic',
				'font_types' => '300 light regular:300:normal,300 light italic:300:italic,400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Roboto Slab',
				'font_styles' => '100,300,regular,700',
				'font_types' => '100 light regular:100:normal,300 light regular:300:normal,400 regular:400:normal,700 bold regular:700:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Satisfy',
				'font_styles' => 'regular',
				'font_types' => '400 regular:400:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Source Code Pro',
				'font_styles' => '200,300,regular,500,600,700,900',
				'font_types' => '200 light regular:200:normal,300 light regular:300:normal,400 regular:400:normal,500 bold regular:500:normal,600 bold regular:600:normal,700 bold regular:700:normal,900 bold regular:900:normal',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Ubuntu',
				'font_styles' => '300,300italic,regular,italic,500,500italic,700,700italic',
				'font_types' => '300 light regular:300:normal,300 light italic:300:italic,400 regular:400:normal,400 italic:400:italic,500 bold regular:500:normal,500 bold italic:500:italic,700 bold regular:700:normal,700 bold italic:700:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Ubuntu Mono',
				'font_styles' => 'regular,italic,700,700italic',
				'font_types' => '400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Vollkorn',
				'font_styles' => 'regular,italic,700,700italic',
				'font_types' => '400 regular:400:normal,400 italic:400:italic,700 bold regular:700:normal,700 bold italic:700:italic',
			);
		$kingFontArray[] = array
			(
				'font_family' => 'Yeseva One',
				'font_styles' => 'regular',
				'font_types' => '400 regular:400:normal',
			);
		return $kingFontArray;
	}
}

class King_Typography_Control extends WP_Customize_Control {
    public $type = 'typography';
 
    public function render_content() {
		$value = $this->value();
		$value = explode(':',$value);
		$default_style = isset($value[1]) && isset($value[2]) ? $value[1].':'.$value[2] : $this->description;
        ?>
        <label>
        <span class="customize-control-title"><?php echo esc_html( $this->label ); ?></span>
        <select id="<?php echo $this->id; ?>" class="google_fonts_form_field King_Typography_Control" default[font_style]="<?php echo $default_style; ?>">
        <?php
        $fonts = king_get_fonts_array();
        foreach ( $fonts as $font_data ): ?>
            <option value="<?php echo $font_data['font_family'] . ':' . $font_data['font_styles']; ?>" data-font_types="<?php echo $font_data['font_types']; ?>" data-font_family ="<?php echo $font_data['font_family']; ?>" data-font_styles="<?php echo $font_data['font_styles']; ?>" class="wp-ult-typography" <?php echo( strtolower( $value[0] ) == strtolower( $font_data['font_family'] ) || strtolower( $value[0] ) == strtolower( $font_data['font_family'] ) . ':' . $font_data['font_styles'] ? 'selected="selected"' : '' ); ?> ><?php echo $font_data['font_family']; ?></option>
        <?php endforeach; ?>
        </select> <br />
        <label class="customize-control-title"><?php _e('Font Style','king'); ?></label>
        <select id="<?php echo $this->id.'_font-style'; ?>"></select>
        <br />
        <input type="hidden" class="<?php echo $this->id; ?>" value="<?php echo $this->value(); ?>" <?php $this->link(); ?> />
        </label>
        <script type="text/javascript">
		jQuery(document).ready(function(){
			var $font_style_dropdown_el = jQuery('#<?php echo $this->id; ?>_font-style');
			var str = jQuery('#<?php echo $this->id; ?>').find(":selected").data('font_types');
			var def = jQuery('#<?php echo $this->id; ?>').find(":selected").text();
            var str_arr=str.split(',');
            var oel='';
			var default_f_style=jQuery('#<?php echo $this->id; ?>').attr('default[font_style]');
            for( var str_inner in str_arr ) {
                var str_arr_inner=str_arr[str_inner].split(':');
                var sel="";
				if(_.isString(default_f_style) && default_f_style.length>0 && str_arr[str_inner]==default_f_style) {
                    sel='selected="selected"';
                }
                oel=oel+'<option '+sel+' value="'+str_arr[str_inner]+'" data-font_family="'+def+'" data-font_weight="'+str_arr_inner[1]+'" data-font_style="'+str_arr_inner[2]+'" class="'+str_arr_inner[2]+'_'+str_arr_inner[1]+'" >'+str_arr_inner[0]+'</option>';
            }
			 $font_style_dropdown_el.html(oel);
			 jQuery('#<?php echo $this->id; ?>').trigger('change');
			 jQuery('#<?php echo $this->id; ?>_font-style').trigger('change');
			 //kingGenerateFont();
			 var $font_family = jQuery('#<?php echo $this->id; ?>').find(":selected").text();
			var $font_weight =jQuery('#<?php echo $this->id; ?>_font-style').find(":selected").data('font_weight');
			var $font_style =jQuery('#<?php echo $this->id; ?>_font-style').find(":selected").data('font_style');
			var $input = jQuery('.<?php echo $this->id; ?>');
			var cf = $font_family+':'+$font_weight+':'+$font_style;
			$input.val(cf);
			$input.trigger('change');
		});
		jQuery('#<?php echo $this->id; ?>').on('change',function(){
			var $font_style_dropdown_el = jQuery('#<?php echo $this->id; ?>_font-style');
			var str = jQuery('#<?php echo $this->id; ?>').find(":selected").data('font_types');
            var str_arr=str.split(',');
            var oel='';
			var default_f_style=jQuery('#<?php echo $this->id; ?>').attr('default[font_style]');
            for( var str_inner in str_arr ) {
                var str_arr_inner=str_arr[str_inner].split(':');
                var sel="";
				var custom_str = str_arr_inner[1]+':'+str_arr_inner[2];
				if(_.isString(default_f_style) && default_f_style.length>0 && custom_str==default_f_style) {
                    sel='selected="selected"';
                }
                oel=oel+'<option '+sel+' value="'+custom_str+'" data-font_weight="'+str_arr_inner[1]+'" data-font_style="'+str_arr_inner[2]+'" class="'+str_arr_inner[2]+'_'+str_arr_inner[1]+'" >'+str_arr_inner[0]+'</option>';

            }
            $font_style_dropdown_el.html(oel);
			jQuery('#<?php echo $this->id; ?>_font-style').trigger('change');
			//kingGenerateFont();
			var $font_family = jQuery('#<?php echo $this->id; ?>').find(":selected").text();
			var $font_weight =jQuery('#<?php echo $this->id; ?>_font-style').find(":selected").data('font_weight');
			var $font_style =jQuery('#<?php echo $this->id; ?>_font-style').find(":selected").data('font_style');
			var $input = jQuery('.<?php echo $this->id; ?>');
			var cf = $font_family+':'+$font_weight+':'+$font_style;
			$input.val(cf);
			$input.trigger('change');
		});
		jQuery('#<?php echo $this->id; ?>_font-style').on('change',function(){
			//kingGenerateFont();
			var $font_family = jQuery('#<?php echo $this->id; ?>').find(":selected").text();
			var $font_weight =jQuery('#<?php echo $this->id; ?>_font-style').find(":selected").data('font_weight');
			var $font_style =jQuery('#<?php echo $this->id; ?>_font-style').find(":selected").data('font_style');
			var $input = jQuery('.<?php echo $this->id; ?>');
			var cf = $font_family+':'+$font_weight+':'+$font_style;
			$input.val(cf);
			$input.trigger('change');
		});
		function kingGenerateFont(){
			var $font_family = jQuery('#<?php echo $this->id; ?>').find(":selected").text();
			var $font_weight =jQuery('#<?php echo $this->id; ?>_font-style').find(":selected").data('font_weight');
			var $font_style =jQuery('#<?php echo $this->id; ?>_font-style').find(":selected").data('font_style');
			var $input = jQuery('.<?php echo $this->id; ?>');
			var cf = $font_family+':'+$font_weight+':'+$font_style;
			$input.val(cf);
			$input.trigger('change');
		}
		</script>
        <?php
    }
}